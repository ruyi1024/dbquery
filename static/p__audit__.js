(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[40],{14689:function(ot,Z,t){"use strict";t.r(Z),t.d(Z,{default:function(){return N}});var dt=t(58024),E=t(91894),it=t(66456),O=t(15885),ct=t(13062),x=t(71230),ht=t(89032),y=t(15746),ft=t(57663),j=t(71577),vt=t(22385),S=t(45777),Y=t(11849),i=t(2824),f=t(39428),C=t(3182),yt=t(47673),A=t(4107),n=t(67294),H=t(67265),K=t(21704),B=t(80129);function M(c){return g.apply(this,arguments)}function g(){return g=(0,C.Z)((0,f.Z)().mark(function c(s){return(0,f.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,K.WY)("/api/v1/audit/query_log?".concat((0,B.stringify)(s))));case 1:case"end":return u.stop()}},c)})),g.apply(this,arguments)}var $=t(59879),G=t(49101),Q=t(30381),W=t.n(Q),m=t(85029),a=t(85893),J=A.Z.Search,St=null,U=function(){var c=(0,C.Z)((0,f.Z)().mark(function s(l){return(0,f.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,M(l);case 3:return r.abrupt("return",r.sent);case 6:return r.prev=6,r.t0=r.catch(0),r.abrupt("return",{success:!1,msg:r.t0});case 9:case"end":return r.stop()}},s,null,[[0,6]])}));return function(l){return c.apply(this,arguments)}}(),V=function(){var s=(0,n.useState)([]),l=(0,i.Z)(s,2),u=l[0],r=l[1],X=(0,n.useState)(0),T=(0,i.Z)(X,2),b=T[0],k=T[1],q=(0,n.useState)(!1),w=(0,i.Z)(q,2),_=w[0],z=w[1],tt=(0,n.useState)(),F=(0,i.Z)(tt,2),I=F[0],et=F[1],at=(0,n.useState)(1),D=(0,i.Z)(at,2),L=D[0],rt=D[1],nt=(0,n.useState)(10),P=(0,i.Z)(nt,2),R=P[0],st=P[1],gt=(0,n.useRef)(),mt=(0,m.md)(),v=function(e){z(!0);var h=(0,Y.Z)({offset:R*(L>=2?L-1:0),limit:R,keyword:e&&e.keyword?e.keyword:I},e);console.log("debug did data -->",h),U(h).then(function(d){d.success&&(r(d.data),k(d.total)),z(!1)})},lt=[{title:"\u8BB0\u5F55\u65F6\u95F4",dataIndex:"gmt_created",sorter:!0,render:function(e){return W()(e).format("YYYY-MM-DD HH:mm:ss")},with:"100"},{title:(0,a.jsx)(m._H,{id:"pages.searchTable.column.user"}),dataIndex:"username",with:"60"},{title:"\u6570\u636E\u6E90",dataIndex:"datasource_type",with:80},{title:"\u6570\u636E\u5E93",dataIndex:"database"},{title:(0,a.jsx)(m._H,{id:"pages.searchTable.column.operate"}),dataIndex:"query_type",sorter:!0},{title:"SQL\u7C7B\u578B",dataIndex:"sql_type",sorter:!0,with:80},{title:"\u6267\u884C\u5185\u5BB9",dataIndex:"content",sorter:!1,ellipsis:{showTitle:!1},render:function(e){return(0,a.jsx)(S.Z,{placement:"topLeft",title:e,children:e})},width:200},{title:"\u6267\u884C\u72B6\u6001",dataIndex:"status",sorter:!0,with:80},{title:"\u6267\u884C\u7ED3\u679C",dataIndex:"result",with:"250",ellipsis:{showTitle:!1},render:function(e){return(0,a.jsx)(S.Z,{placement:"topLeft",title:e,children:e})},textWrap:"word-break"}];(0,n.useEffect)(function(){v("")},[]);var ut=function(e,h,d){var p={offset:e.pageSize*(e.current>=2?e.current-1:0),limit:e.pageSize,keyword:I,sorterField:"",sorterOrder:""};d.field&&(p.sorterField="".concat(d.field),p.sorterOrder="".concat(d.order)),rt(e.current),st(e.pageSize),v(p)};return(0,a.jsx)(H.ZP,{children:(0,a.jsxs)(E.Z,{size:"small",bodyStyle:{padding:10},children:[(0,a.jsxs)(x.Z,{children:[(0,a.jsxs)(y.Z,{flex:"auto",children:[(0,a.jsx)(J,{placeholder:"\u652F\u6301\u641C\u7D22\u8D26\u53F7\u3001\u59D3\u540D",onSearch:function(e){console.log("debug on search --> ",e),et(e),v({keyword:e})},style:{width:280}}),(0,a.jsx)(S.Z,{placement:"top",title:"\u91CD\u8F7D\u5E76\u5237\u65B0\u8868\u683C\u6570\u636E",children:(0,a.jsx)(j.Z,{type:"link",icon:(0,a.jsx)($.Z,{}),onClick:function(){return v("")}})})]}),(0,a.jsx)(y.Z,{span:2,children:(0,a.jsx)(j.Z,{type:"link",icon:(0,a.jsx)(G.Z,{}),onClick:function(){return handleUpdateModalVisible(!0)},children:"\u5BFC\u51FA\u6570\u636E"})})]}),(0,a.jsx)(x.Z,{style:{paddingTop:10},children:(0,a.jsx)(y.Z,{span:24,children:(0,a.jsx)(O.Z,{size:"small",rowKey:"id",loading:_,columns:lt,dataSource:u,onChange:ut,pagination:{total:b,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],showQuickJumper:!0,showTotal:function(e,h){return"\u7B2C ".concat(h[0],"-").concat(h[1],"\u6761\uFF0C \u5171 ").concat(e,"\u6761")}}})})})]})})},N=V}}]);
